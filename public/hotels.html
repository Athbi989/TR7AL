<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trhal</title>
    <link rel="icon" href="./globe.png" />
    <!-- Awesome Fonts (For Icons only) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.min.css" />
    <!-- My Style's CSS -->
    <link rel="stylesheet" href="./assets/css/main.css" />
    <link rel="stylesheet" href="./assets/css/helpers.css" />
    <link rel="stylesheet" href="./assets/css/forms.css" />
  </head>

  <body dir="rtl">
    <!-- Preloader -->
    <div id="loader-wrapper">
      <div id="loader"></div>
      <div class="loader-section section-left"></div>
      <div class="loader-section section-right"></div>
    </div>
    <!-- Main - Header (flexboxed) -->
    <header>
      <div class="flex-header">
        <!-- Right side of header -->
        <div class="right-side">
          <div class="tilte-container">
            <h1>تّرحال</h1>
            <img width="42" src="./globe.png" alt="" />
          </div>
        </div>
        <!-- Left side of header -->
        <div class="left-side">
          <!-- User Settings Labels -->
          <div class="dropdown">
            <button class="btn btn-light dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img src="./assets/flags/kw.png" width="16" /> دينار</button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="#"><img src="./assets/flags/kw.png" width="16" /> دينار </a>
              <a class="dropdown-item" href="#"><img src="./assets/flags/ae.png" width="16" /> درهم </a>
              <a class="dropdown-item" href="#"><img src="./assets/flags/sa.png" width="16" /> ريال </a>
            </div>
          </div>
          <!-- Light Dark Switcher -->
          <div class="SwitcherDiv">
            <input type="checkbox" class="modrenSwitch" onchange="switchTheme(this.checked)" id="chk" />
            <label class="switch" for="chk">
              <i class="fas fa-moon"></i>
              <i class="fas fa-sun"></i>
              <div class="ball"></div>
            </label>
          </div>
        </div>
      </div>
    </header>

    <!-- Sidebar (flexboxed) -->
    <nav class="navbar-trhal">
      <ul class="navbar-nav">
        <li class="logo">
          <a href="#" class="nav-link">
            <span class="link-text logo-text">Hive it </span>
            <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="plane-departure" class="svg-inline--fa fa-plane-departure fa-w-20" role="img" viewBox="0 0 640 512">
              <path
                fill="currentColor"
                d="M624 448H16c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h608c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zM80.55 341.27c6.28 6.84 15.1 10.72 24.33 10.71l130.54-.18a65.62 65.62 0 0 0 29.64-7.12l290.96-147.65c26.74-13.57 50.71-32.94 67.02-58.31 18.31-28.48 20.3-49.09 13.07-63.65-7.21-14.57-24.74-25.27-58.25-27.45-29.85-1.94-59.54 5.92-86.28 19.48l-98.51 49.99-218.7-82.06a17.799 17.799 0 0 0-18-1.11L90.62 67.29c-10.67 5.41-13.25 19.65-5.17 28.53l156.22 98.1-103.21 52.38-72.35-36.47a17.804 17.804 0 0 0-16.07.02L9.91 230.22c-10.44 5.3-13.19 19.12-5.57 28.08l76.21 82.97z"
              />
            </svg>
          </a>
        </li>
        <!-- Sidebar Items (also flexboxed) -->
        <li class="nav-item">
          <a href="./index.html" class="nav-link">
            <i class="fa fa-home clx"></i>
            <span class="side-menu__label">رئيسي</span>
            <!-- <span class="nav-tip">الصفحة الرئيسية</span> -->
          </a>
        </li>

        <li class="nav-item">
          <a href="./popular.html" class="nav-link">
            <i class="fas fa-fire clx"></i>
            <span class="side-menu__label">الشائع</span>
          </a>
        </li>

        <li class="nav-item">
          <a href="./explore.html" class="nav-link">
            <i class="fas fa-search clx"></i>
            <span class="side-menu__label">إكتشف</span>
          </a>
        </li>

        <li class="nav-item">
          <a href="./map.html" class="nav-link">
            <i class="fas fa-map clx"></i>
            <span class="side-menu__label">الخريطة</span>
          </a>
        </li>

        <li class="nav-item nav-active">
          <a href="./hotels.html" class="nav-link">
            <i class="fas fa-hotel clx"></i>
            <span class="side-menu__label">الفنادق</span>
          </a>
        </li>

        <li class="nav-item">
          <a href="./flights.html" class="nav-link">
            <i class="fas fa-plane clx"></i>
            <span class="side-menu__label">الطيران</span>
          </a>
        </li>

        <li class="nav-item">
          <a href="./flights.html" class="nav-link">
            <i class="fas fa-coins clx"></i>
            <span class="side-menu__label">العملات</span>
          </a>
        </li>

        <li class="nav-item">
          <a href="./covid19.html" class="nav-link">
            <i class="fas fa-pills clx"></i>
            <span class="side-menu__label">كوفيد-19</span>
          </a>
        </li>

        <li class="nav-item">
          <a href="#" class="nav-link">
            <span class="side-menu__label"></span>
          </a>
        </li>
      </ul>
    </nav>

    <style>
      #atrraction_json {
        padding: 60px;
        padding-right: 0;
        padding-top: 0;
        justify-content: flex-start;
      }

      .autocomplete-items {
        border: 0;
      }

      @media only screen and (max-width: 1290px) {
        .main-title {
          width: 85%;
        }
      }

      @media only screen and (max-width: 600px) {
        #form_input {
          flex-direction: column;
        }

        #dom_conatiner {
          display: flex;
          justify-content: center;
          align-items: center;
          flex-direction: column;
        }

        #atrraction_json {
          justify-content: center;
        }
      }
    </style>
    <main>
      <!-- All Page Content gose her -->
      <div class="container-cl">
        <div class="block-title">
          <!-- Background -->
          <div class="backgroun-title backgroun-third"></div>
          <div style="margin-top: -50px">
            <div class="big-title">ابحث عن الفنادق</div>
            <h3>تحاتي الفنادق ؟ حط المعلومات ولاتحاتي</h3>
          </div>
        </div>
        <div id="form_input" class="container main-title cl-shadow">
          <label>الوجهة</label>
          <div class="autocomplete">
            <input type="text" id="CountryInput" class="input-search" style="width: auto" placeholder="اين هي وجهتك ؟" />
          </div>
          <label>عدد الليالي</label>
          <input type="number" id="nights" class="input-search" style="width: auto" value="2" />
          <label>تاريخ الوصول</label>
          <input type="date" id="checkIn" class="input-search" style="width: auto" />
          <input type="button" class="button-search" onclick="processJob();" value="ترحل" />
        </div>
        <!-- Loader -->
        <loader id="loader_r" style="width: 75%; margin-top: 25px; display: none">
          <div></div>
          <h2>جاري تحميل ..</h2>
        </loader>
        <!-- DOM Result -->
        <div id="dom_conatiner" style="display: none">
          <div class="container" style="padding-top: 10px; width: 92%; justify-content: space-between">
            <a onclick="scrollData('next')" class="clickable_icon"><i class="fas fa-arrow-right clx"></i></a>
            <a onclick="scrollData('pre')" class="clickable_icon"><i class="fas fa-arrow-left clx"></i></a>
          </div>
          <div class="" id="atrraction_json">
            <!-- Ajax handled here -->
          </div>
        </div>
      </div>
    </main>
    <script src="./assets/js/jquery.min.js"></script>
    <script src="./assets/js/main.js"></script>
    <script src="./assets/js/countries.js"></script>
    <script src="./assets/js/forms.js"></script>
    <script src="./assets/js/iso.js"></script>

    <script>
      /* Vars */
      var __BACKGROUND_PROCCESS = false;
      let __HOTELS_PAGE = 0;
      let __HOTELS_LIST = {
        token: "0",
        data: [],
      };
      /* Calling Overview requests */
      let getHotelsLists = function (query, nights = 2, checkIn, page = "none") {
        return new Promise(function (resolve) {
          __BACKGROUND_PROCCESS = true;
          if (page != "none") {
            page = 30 * page;
          }
          ajaxRequest("action=getHotelList&query=" + query + "&nights=" + nights + "&page=" + page + "&checkIn=" + checkIn, false).then(function (data) {
            if (data) {
              let respone = $.parseJSON(data);
              resolve(respone);
            } else {
              resolve(false);
            }
          });
        });
      };
      /* DOM Functionality */
      let grabHotels = function () {
        return new Promise(function (resolve) {
          let countreyCode = searchCountry(document.getElementById("CountryInput").value);
          let checkIn = document.getElementById("checkIn").value;
          let nights = document.getElementById("nights").value;
          let countreyQuery = undefined;
          if (countreyCode != undefined) {
            countreyQuery = getCountryName(countreyCode["code"].toUpperCase());
          }
          if (countreyQuery == undefined || checkIn == "" || nights == "") {
            resolve(false);
            return;
          }
          getHotelsLists(countreyQuery, nights, checkIn, __HOTELS_PAGE).then(function (respone) {
            if (respone != false) {
              //DOM DATA
              // __ATTRACTION_LIST["token"] = respone["nextToken"];
              __HOTELS_LIST["data"].push(respone["data"]);
              showHotelList(respone["data"]);
              resolve();
            } else {
              resolve(false);
            }
          });
        });
      };

      function processJob() {
        if (__BACKGROUND_PROCCESS == false) {
          __BACKGROUND_PROCCESS = true;
          document.getElementById("dom_conatiner").style.display = "none";
          document.getElementById("loader_r").style.display = "flex";
          grabHotels().then(function (respone) {
            if (respone == false) {
              //Something went wrong
              alert("الرجاء ملء الفراغات");
            }
            document.getElementById("dom_conatiner").style.display = "block";
            document.getElementById("loader_r").style.display = "none";
            __BACKGROUND_PROCCESS = false;
          });
        } else {
          alert("الرجاء الإنتظار لأنهاء العملية");
        }
      }

      function scrollData(type) {
        if (type == "next") {
          __HOTELS_PAGE++;
        } else {
          if (__HOTELS_PAGE != 0) {
            __HOTELS_PAGE--;
          } else {
            return;
          }
        }
        if (__HOTELS_LIST["data"][__HOTELS_PAGE] != undefined) {
          let targted = __HOTELS_LIST["data"][__HOTELS_PAGE];
          showHotelList(targted);
        } else {
          document.getElementById("dom_conatiner").style.display = "none";
          document.getElementById("loader_r").style.display = "flex";
          grabHotels().then(function (respone) {
            document.getElementById("dom_conatiner").style.display = "block";
            document.getElementById("loader_r").style.display = "none";
          });
        }
      }

      function showHotelList(data) {
        let dataView = document.getElementById("atrraction_json");
        dataView.innerHTML = "";
        for (let item of Object.keys(data)) {
          var Place = data[item];
          let img = "";
          let link = "#";
          try {
            img = Place["photo"]["images"]["large"]["url"];
          } catch (error) {
            img = "./assets/images/notfound.png";
          }
          if (Place["hac_offers"]["offers"].length > 0) {
            link = Place["hac_offers"]["offers"][0]["link"];
          }
          dataView.innerHTML += `
        <div class="card__ty2">
          <div class="info">
            <div class="sub1"><span>${Place.name} <img width="24" src="./assets/images/geocode.png" alt="" srcset=""></span></div>
            <div class="sub1">${Place.price}</div>
            <div class="price">${Place.location_string}</div>
            <div class="sub2">Rating : <span class="rating_label">${Place.rating}/5</span></div></div>
            <a href="${link}" target="_blank" class="clickable_icon">
              <i class="fas fa-map-marker-alt clx"></i>
            </a>
            <div class="img">
            <div class="overly"></div>
            <img class="img-country" src="${img}" alt="" srcset="">
          </div>
        </div>
        `;
        }
      }
      autocomplete(document.getElementById("CountryInput"), countries);
    </script>
  </body>
</html>
